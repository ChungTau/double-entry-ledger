# Kafka Helm Values - Development Environment
# Chart: oci://registry-1.docker.io/bitnamicharts/kafka
# Install: helm install kafka oci://registry-1.docker.io/bitnamicharts/kafka -f kafka-values.yaml -n ledger-dev

image:
  tag: "4.0"
  pullPolicy: IfNotPresent

# KRaft mode (no ZooKeeper required)
kraft:
  enabled: true
  clusterId: ""  # Auto-generated if empty

# Combined controller and broker mode for dev
controller:
  replicaCount: 1

  persistence:
    enabled: true
    size: 5Gi

  resources:
    requests:
      memory: "256Mi"
      cpu: "100m"
    limits:
      memory: "512Mi"
      cpu: "500m"

  # Health probes
  livenessProbe:
    enabled: true
    initialDelaySeconds: 60
    periodSeconds: 10

  readinessProbe:
    enabled: true
    initialDelaySeconds: 30
    periodSeconds: 5

# Disable separate broker since we use combined mode in dev
broker:
  replicaCount: 0

# Kafka configuration matching docker-compose
extraConfig: |
  num.partitions=3
  default.replication.factor=1
  offsets.topic.replication.factor=1
  transaction.state.log.replication.factor=1
  transaction.state.log.min.isr=1
  group.initial.rebalance.delay.ms=0
  auto.create.topics.enable=true

# Create required topics on startup
provisioning:
  enabled: true
  topics:
    - name: transaction-events
      partitions: 3
      replicationFactor: 1
      config:
        retention.ms: "604800000"  # 7 days
    - name: transactions-dlq
      partitions: 3
      replicationFactor: 1
      config:
        retention.ms: "2592000000"  # 30 days

# Listener configuration
listeners:
  client:
    protocol: PLAINTEXT
    containerPort: 9092
  controller:
    protocol: PLAINTEXT
    containerPort: 9093
  interbroker:
    protocol: PLAINTEXT
    containerPort: 9094

# Service configuration
service:
  type: ClusterIP
  ports:
    client: 9092

# Metrics for Prometheus scraping
metrics:
  kafka:
    enabled: true
  jmx:
    enabled: true
  serviceMonitor:
    enabled: true
    namespace: ledger-dev
    labels:
      release: prometheus
